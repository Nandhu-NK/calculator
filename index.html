<!-- Save this as calculator.html and open in a browser -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sleek Web Calculator</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#7c3aed; --muted:#9aa4b2; --text:#e6eef6;
      --btn:#0e1524; --btn-hover:#131a2a; --danger:#ef4444;
      font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; display:flex; align-items:center; justify-content:center;
      background:linear-gradient(180deg, #071024 0%, #071022 100%); color:var(--text);
      padding:24px;
    }
    .calculator{
      width:360px; max-width:100%;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:18px; padding:18px; box-shadow:0 10px 30px rgba(2,6,23,0.7);
      border:1px solid rgba(255,255,255,0.03);
    }
    .screen{
      background:transparent; padding:12px; border-radius:12px;
      min-height:96px; display:flex; flex-direction:column; justify-content:center;
      gap:6px;
    }
    .history{
      font-size:12px; color:var(--muted); overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
      opacity:0.9;
    }
    .display{
      font-size:28px; font-weight:600; text-align:right; color:var(--text);
      word-break:break-all;
    }
    .kbd{
      display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-top:14px;
    }
    button.key{
      background:var(--btn); border:1px solid rgba(255,255,255,0.02); color:var(--text);
      padding:16px; font-size:16px; border-radius:10px; cursor:pointer; user-select:none;
      transition:transform .06s ease, background .12s;
      box-shadow:0 4px 12px rgba(2,6,23,0.6);
    }
    button.key:active{ transform:translateY(1px) scale(.998); }
    button.key:hover{ background:var(--btn-hover); }
    button.op{ background:linear-gradient(180deg, rgba(124,58,237,0.16), rgba(124,58,237,0.08)); color:var(--text); }
    button.wide{ grid-column: span 2; }
    button.danger{ background:linear-gradient(180deg, rgba(239,68,68,0.12), rgba(239,68,68,0.06)); color:var(--text); }
    .footer{ margin-top:10px; display:flex; justify-content:space-between; font-size:12px; color:var(--muted); }
    .small{ font-size:13px; color:var(--muted) }
    @media (max-width:380px){
      .display{ font-size:22px }
      button.key{ padding:12px; font-size:15px }
    }
  </style>
</head>
<body>
  <div class="calculator" role="application" aria-label="Calculator">
    <div class="screen" aria-hidden="false">
      <div class="history" id="history">—</div>
      <div class="display" id="display">0</div>
    </div>

    <div class="kbd" id="keys" aria-hidden="false">
      <button class="key" data-action="clear" title="Clear (C)">C</button>
      <button class="key" data-action="back" title="Backspace (⌫)">⌫</button>
      <button class="key" data-value="%" title="Percent">%</button>
      <button class="key op" data-value="/" title="Divide">÷</button>

      <button class="key" data-value="7">7</button>
      <button class="key" data-value="8">8</button>
      <button class="key" data-value="9">9</button>
      <button class="key op" data-value="*" title="Multiply">×</button>

      <button class="key" data-value="4">4</button>
      <button class="key" data-value="5">5</button>
      <button class="key" data-value="6">6</button>
      <button class="key op" data-value="-" title="Subtract">−</button>

      <button class="key" data-value="1">1</button>
      <button class="key" data-value="2">2</button>
      <button class="key" data-value="3">3</button>
      <button class="key op" data-value="+" title="Add">+</button>

      <button class="key" data-action="neg" title="Toggle sign">±</button>
      <button class="key" data-value="0">0</button>
      <button class="key" data-value="." title="Decimal point">.</button>
      <button class="key op wide" data-action="equals" title="Equals (Enter)">=</button>
    </div>

    <div class="footer">
      <div class="small">Keyboard: digits, + - * / ( ) Enter =, Backspace, C</div>
      <div class="small">Made for practice</div>
    </div>
  </div>

  <script>
  (function(){
    const displayEl = document.getElementById('display');
    const historyEl = document.getElementById('history');
    const keys = document.getElementById('keys');

    let expr = '';   // visible expression string (user-friendly)
    let lastResult = null;

    function render(){
      displayEl.textContent = expr === '' ? '0' : expr;
      historyEl.textContent = lastResult === null ? '—' : lastResult;
    }

    // Tokenizer: numbers (with decimal), operators, parentheses, percent
    function tokenize(s){
      const tokens = [];
      const re = /\s*([0-9]*\.?[0-9]+|[+\-*/()%()])\s*/g;
      // We'll do a manual stateful tokenizer to properly detect '%' and unary minus
      let i = 0;
      while(i < s.length){
        const ch = s[i];
        if(/\s/.test(ch)){ i++; continue; }
        if(/[0-9.]/.test(ch)){
          let j = i;
          while(j < s.length && /[0-9.]/.test(s[j])) j++;
          tokens.push({type:'number', value: s.slice(i,j) });
          i = j;
          continue;
        }
        if(ch === '%'){
          tokens.push({type:'percent', value:'%'}); i++; continue;
        }
        if(ch === '(' || ch === ')'){
          tokens.push({type:'paren', value:ch}); i++; continue;
        }
        if(/[+\-*/]/.test(ch)){
          // distinguish unary minus
          const prev = tokens.length ? tokens[tokens.length-1] : null;
          if(ch === '-' && (!prev || (prev.type === 'operator' || (prev.type==='paren' && prev.value==='(')))){
            // unary minus: we represent it as "u-" operator
            tokens.push({type:'operator', value:'u-'});
          } else {
            tokens.push({type:'operator', value: ch});
          }
          i++; continue;
        }
        // Unexpected char -> skip
        i++;
      }
      return tokens;
    }

    // Shunting-yard: convert to RPN
    function toRPN(tokens){
      const out = [];
      const opStack = [];
      const precedence = { '%':4, 'u-':4, '*':3, '/':3, '+':2, '-':2 };
      const rightAssoc = { 'u-': true }; // unary minus is right-associative
      tokens.forEach(tok => {
        if(tok.type === 'number') out.push(tok);
        else if(tok.type === 'percent') {
          // percent is unary postfix: treat as operator with highest prec
          out.push({type:'number', value: null, isPercent:true}); // placeholder - we'll handle in eval
        }
        else if(tok.type === 'operator'){
          const op = tok.value;
          while(opStack.length){
            const top = opStack[opStack.length-1];
            if(top.type === 'operator' &&
               (( !rightAssoc[op] && precedence[op] <= precedence[top.value] ) ||
                ( rightAssoc[op] && precedence[op] < precedence[top.value] ))){
              out.push(opStack.pop());
            } else break;
          }
          opStack.push(tok);
        } else if(tok.type === 'paren'){
          if(tok.value === '(') opStack.push(tok);
          else {
            // pop until '('
            while(opStack.length && !(opStack[opStack.length-1].type === 'paren' && opStack[opStack.length-1].value === '(')){
              out.push(opStack.pop());
            }
            if(opStack.length && opStack[opStack.length-1].type === 'paren' && opStack[opStack.length-1].value === '('){
              opStack.pop();
            } else {
              throw new Error('Mismatched parentheses');
            }
          }
        }
      });
      while(opStack.length){
        const t = opStack.pop();
        if(t.type === 'paren') throw new Error('Mismatched parentheses');
        out.push(t);
      }
      return out;
    }

    // Evaluate RPN
    function evalRPN(rpn){
      const st = [];
      for(let i=0;i<rpn.length;i++){
        const tok = rpn[i];
        if(tok.type === 'number'){
          if(tok.isPercent){
            // apply percent to previous value (postfix)
            if(st.length === 0) throw new Error('Bad percent usage');
            const v = st.pop();
            st.push(v / 100);
          } else {
            st.push(parseFloat(tok.value));
          }
        } else if(tok.type === 'operator'){
          const op = tok.value;
          if(op === 'u-'){
            if(st.length < 1) throw new Error('Bad unary minus');
            const a = st.pop();
            st.push(-a);
          } else {
            if(st.length < 2) throw new Error('Insufficient operands');
            const b = st.pop(), a = st.pop();
            let res = 0;
            if(op === '+') res = a + b;
            else if(op === '-') res = a - b;
            else if(op === '*') res = a * b;
            else if(op === '/') {
              if(b === 0) throw new Error('Division by zero');
              res = a / b;
            } else throw new Error('Unknown operator ' + op);
            st.push(res);
          }
        } else {
          throw new Error('Invalid token in RPN');
        }
      }
      if(st.length !== 1) throw new Error('Invalid expression');
      return st[0];
    }

    function safeEvaluate(input){
      // Replace the visual ÷ and × with / and *
      const clean = input.replace(/÷/g,'/').replace(/×/g,'*').replace(/−/g,'-');
      const tokens = tokenize(clean);
      const rpn = toRPN(tokens);
      const result = evalRPN(rpn);
      return result;
    }

    // Input helpers
    function pushInput(ch){
      // Allow only valid sequences: don't allow two decimals in same number, etc.
      // For simplicity, just append and rely on parser; but prevent multiple % right after each other
      if(ch === '%'){
        // If last char already %, ignore
        if(expr.endsWith('%')) return;
        // If expr is empty or last is operator or '(', ignore
        const last = expr.slice(-1);
        if(expr === '' || /[+\-*/(]/.test(last)) return;
      }
      expr += ch;
      render();
    }

    function clearAll(){
      expr = '';
      lastResult = null;
      render();
    }

    function backspace(){
      if(expr.length === 0) return;
      expr = expr.slice(0,-1);
      render();
    }

    function toggleSign(){
      // Try to toggle sign of the last number in expr
      // Find last number token boundary
      let i = expr.length - 1;
      while(i >= 0 && /[0-9.%]/.test(expr[i])) i--;
      // i is now index before number (or -1)
      const before = expr.slice(0, i+1);
      const num = expr.slice(i+1);
      if(num === '') return;
      // If number already wrapped like (-x) (rare), skip. We'll wrap with ( -num )
      const wrapped = '(' + (before.endsWith('(') ? '' : '') + '-' + num + ')';
      expr = before + wrapped;
      render();
    }

    function compute(){
      if(!expr) return;
      try {
        const result = safeEvaluate(expr);
        lastResult = result;
        expr = String(result);
        render();
      } catch(e){
        lastResult = 'Error';
        displayEl.textContent = 'Error';
        console.error(e);
      }
    }

    // Button clicks
    keys.addEventListener('click', (ev) => {
      const btn = ev.target.closest('button');
      if(!btn) return;
      const val = btn.getAttribute('data-value');
      const action = btn.getAttribute('data-action');
      if(action === 'clear') clearAll();
      else if(action === 'back') backspace();
      else if(action === 'equals') compute();
      else if(action === 'neg') toggleSign();
      else if(val) {
        pushInput(val);
      }
    });

    // Keyboard support
    window.addEventListener('keydown', (ev) => {
      const key = ev.key;
      if(/^[0-9]$/.test(key)) { pushInput(key); ev.preventDefault(); return; }
      if(key === '.' ) { pushInput('.'); ev.preventDefault(); return; }
      if(key === '+' || key === '-' || key === '*' || key === '/') { pushInput(key); ev.preventDefault(); return; }
      if(key === '%' ) { pushInput('%'); ev.preventDefault(); return; }
      if(key === 'Enter' || key === '='){ compute(); ev.preventDefault(); return; }
      if(key === 'Backspace'){ backspace(); ev.preventDefault(); return; }
      if(key === 'Escape' || key.toLowerCase() === 'c'){ clearAll(); ev.preventDefault(); return; }
      if(key === '(' || key === ')'){ pushInput(key); ev.preventDefault(); return; }
    });

    // initial render
    render();
  })();
  </script>
</body>
</html>
